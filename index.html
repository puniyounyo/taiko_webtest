<!DOCTYPE html>
<html>
<head>
  <title>太鼓入力デバイス設定</title>
</head>
<body>
  <h1>太鼓入力デバイス設定</h1>

  <p>se0: <span id="se0"></span></p>
  <p>se1: <span id="se1"></span></p>
  <p>se2: <span id="se2"></span></p>
  <p>se3: <span id="se3"></span></p>
  <p>A: <span id="A"></span></p>
  <p>B: <span id="B"></span></p>
  <p>C: <span id="C"></span></p>
  <p>p1: <span id="p1"></span></p>
  <p>ha: <span id="ha"></span></p>

  <h2>設定変更</h2>
  <form id="settingsForm">
    <label for="se0Input">se0:</label>
    <input type="number" id="se0Input" name="se0"><br>

    <label for="se1Input">se1:</label>
    <input type="number" id="se1Input" name="se1"><br>

    <label for="se2Input">se2:</label>
    <input type="number" id="se2Input" name="se2"><br>

    <label for="se3Input">se3:</label>
    <input type="number" id="se3Input" name="se3"><br>

    <label for="AInput">A:</label>
    <input type="number" id="AInput" name="A"><br>

    <label for="BInput">B:</label>
    <input type="number" id="BInput" name="B"><br>

    <label for="CInput">C:</label>
    <input type="number" id="CInput" name="C"><br>

    <label for="p1Input">p1:</label>
    <input type="number" id="p1Input" name="p1"><br>

    <label for="haInput">ha:</label>
    <input type="number" id="haInput" name="ha"><br>

    <button type="button" id="applyButton">適用</button>
  </form>

  <script>
    // WebUSBでデータを受信する処理
    navigator.usb.requestPort().then(port => {
      port.open().then(() => {
        port.transferIn(1, 64).then(result => {
          const decoder = new TextDecoder();
          const jsonString = decoder.decode(result.data);
          const settings = JSON.parse(jsonString);
          // 設定値をHTML要素に表示
          document.getElementById("se0").textContent = settings.se0;
          document.getElementById("se1").textContent = settings.se1;
          document.getElementById("se2").textContent = settings.se2;
          document.getElementById("se3").textContent = settings.se3;
          document.getElementById("A").textContent = settings.A;
          document.getElementById("B").textContent = settings.B;
          document.getElementById("C").textContent = settings.C;
          document.getElementById("p1").textContent = settings.p1;
          document.getElementById("ha").textContent = settings.ha;

          // フォームに現在の設定値を表示
          document.getElementById("se0Input").value = settings.se0;
          document.getElementById("se1Input").value = settings.se1;
          document.getElementById("se2Input").value = settings.se2;
          document.getElementById("se3Input").value = settings.se3;
          document.getElementById("AInput").value = settings.A;
          document.getElementById("BInput").value = settings.B;
          document.getElementById("CInput").value = settings.C;
          document.getElementById("p1Input").value = settings.p1;
          document.getElementById("haInput").value = settings.ha;
        });

        // 適用ボタンのイベントリスナー
        document.getElementById("applyButton").addEventListener("click", () => {
          const form = document.getElementById("settingsForm");
          const formData = new FormData(form);
          const settings = {};
          formData.forEach((value, key) => {
            settings[key] = parseInt(value);
          });
          const jsonString = JSON.stringify(settings);
          const encoder = new TextEncoder();
          const data = encoder.encode(jsonString);
          port.transferOut(1, data);
        });
      });
    });
  </script>
</body>
</html>
